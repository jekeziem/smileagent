<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmileAgent | Your Smile, Optimised</title>

    <script defer data-domain="smileagent-heak.onrender.com" src="https://plausible.io/js/script.js"></script>

    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600&family=Fraunces:wght@500;600;700&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        emerald: { 50: '#ECFDF5', 100: '#D1FAE5', 200: '#A7F3D0', 500: '#059669', 600: '#047857', 700: '#065F46' },
                        gray: { 50: '#F9FAFB', 100: '#F3F4F6', 200: '#E5E7EB', 400: '#9CA3AF', 500: '#6B7280', 700: '#374151', 900: '#111827' },
                        red: { 50: '#FEF2F2', 100: '#FEE2E2', 500: '#EF4444', 600: '#DC2626' },
                        amber: { 50: '#FFFBEB', 100: '#FEF3C7', 500: '#F59E0B', 600: '#D97706' }
                    },
                    fontFamily: { sans: ['DM Sans', 'sans-serif'], heading: ['Fraunces', 'serif'] },
                    boxShadow: { 'soft': '0 20px 40px -15px rgba(0, 0, 0, 0.08)', 'card': '0 4px 20px rgba(5, 150, 105, 0.1)' },
                    animation: { 'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite', 'slide-up': 'slideUp 0.3s ease-out', 'fade-in': 'fadeIn 0.4s ease-out' },
                    keyframes: {
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } }
                    }
                }
            }
        }
    </script>

    <style>
        [v-cloak] { display: none !important; }
        @keyframes scan { 0%, 100% { top: 10%; } 50% { top: 85%; } }
        .scanner-line { animation: scan 2s ease-in-out infinite; }
        .toast-enter { animation: slideInRight 0.3s ease-out; }
        .toast-exit { animation: slideOutRight 0.3s ease-out forwards; }
        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slideOutRight { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }
        .clinic-card { transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .clinic-card:hover { transform: translateY(-2px); }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #059669; border-radius: 10px; }
        .urgent-mode { background: linear-gradient(180deg, #FEF2F2 0%, #FFFFFF 100%); }
        body { background: #f0f2f5; }
        #app { max-width: 500px; margin: 0 auto; background: #ffffff; min-height: 100vh; box-shadow: 0 0 20px rgba(0,0,0,0.05); }
    </style>
</head>
<body class="bg-gradient-to-br from-emerald-50 via-white to-emerald-50 min-h-screen">

<div id="app" v-cloak>
    <div class="fixed top-4 right-4 z-50 space-y-2">
        <div v-for="toast in toasts" :key="toast.id"
             :class="['px-4 py-3 rounded-xl shadow-lg max-w-sm', toast.exiting ? 'toast-exit' : 'toast-enter',
                      toast.type === 'success' ? 'bg-emerald-500 text-white' : '',
                      toast.type === 'error' ? 'bg-red-500 text-white' : '',
                      toast.type === 'info' ? 'bg-gray-800 text-white' : '',
                      toast.type === 'warning' ? 'bg-amber-500 text-white' : '']">
            <div class="flex items-center gap-2">
                <i v-if="toast.type === 'success'" class="ph ph-check-circle text-lg"></i>
                <i v-if="toast.type === 'error'" class="ph ph-x-circle text-lg"></i>
                <i v-if="toast.type === 'info'" class="ph ph-info text-lg"></i>
                <i v-if="toast.type === 'warning'" class="ph ph-warning text-lg"></i>
                <span class="text-sm font-medium">{{ toast.message }}</span>
            </div>
        </div>
    </div>

    <div class="max-w-md mx-auto px-4 py-6 min-h-screen" :class="{ 'urgent-mode': isEmergencyMode && triageStep > 0 }">
        
        <header class="text-center mb-6">
            <div class="flex items-center justify-between mb-4">
                <div class="inline-flex items-center gap-2 bg-white/80 backdrop-blur px-4 py-2 rounded-full shadow-soft cursor-pointer" @click="goHome">
                    <div class="w-8 h-8 bg-emerald-500 rounded-full flex items-center justify-center">
                        <i class="ph ph-tooth text-white text-lg"></i>
                    </div>
                    <span class="font-heading font-semibold text-gray-900">SmileAgent</span>
                </div>
                <div class="text-xs font-semibold text-emerald-600 bg-emerald-50 px-3 py-1.5 rounded-full border border-emerald-100">
                    Dublin 22 Pilot
                </div>
            </div>
            <h1 v-if="!appMode" class="font-heading text-2xl font-bold text-gray-900 mb-1">Your Smile,<br>Optimised.</h1>
            <h1 v-else-if="appMode === 'emergency'" class="font-heading text-2xl font-bold text-gray-900 mb-1">
                {{ triageStep === 0 ? 'Emergency Dental Help' : triageStep === 'ae_redirect' ? 'ðŸš¨ Hospital Required' : 'Finding You Care' }}
            </h1>
            <h1 v-else class="font-heading text-2xl font-bold text-gray-900 mb-1">Your Smile,<br>Optimised.</h1>
            <p v-if="!appMode" class="text-sm text-gray-500">The Relief You Need.<br>The Smile You Want.</p>
        </header>

        <div v-if="!appMode" class="animate-fade-in space-y-4">
            <div class="bg-white rounded-2xl shadow-soft p-5">
                <h2 class="text-lg font-semibold text-gray-900 mb-4 text-center">What brings you here today?</h2>
                
                <div class="grid grid-cols-2 gap-3 mb-4">
                    <button @click="startEmergencyMode" 
                            class="p-5 rounded-xl border-2 border-red-200 bg-red-50 hover:border-red-400 hover:bg-red-100 transition-all text-center">
                        <div class="w-12 h-12 bg-red-500 rounded-full flex items-center justify-center mx-auto mb-3">
                            <i class="ph ph-first-aid text-2xl text-white"></i>
                        </div>
                        <span class="font-semibold text-gray-900 block">I'm in Pain</span>
                        <span class="text-xs text-gray-500">Find urgent help</span>
                    </button>
                    
                    <button @click="startCosmeticMode" 
                            class="p-5 rounded-xl border-2 border-emerald-200 bg-emerald-50 hover:border-emerald-400 hover:bg-emerald-100 transition-all text-center">
                        <div class="w-12 h-12 bg-emerald-500 rounded-full flex items-center justify-center mx-auto mb-3">
                            <i class="ph ph-smiley text-2xl text-white"></i>
                        </div>
                        <span class="font-semibold text-gray-900 block">Improve My Smile</span>
                        <span class="text-xs text-gray-500">Cosmetic treatments</span>
                    </button>
                </div>
                
                <button @click="skipToCheckup" class="w-full py-3 text-sm text-gray-500 hover:text-gray-700">
                    <i class="ph ph-calendar-check mr-1"></i>
                    I just need a routine checkup
                </button>
            </div>
            
            <div class="grid grid-cols-3 gap-2 text-center">
                <div class="bg-white/80 rounded-xl p-3">
                    <div class="text-lg font-bold text-emerald-600">3</div>
                    <div class="text-[10px] text-gray-500">Clinics</div>
                </div>
                <div class="bg-white/80 rounded-xl p-3">
                    <div class="text-lg font-bold text-emerald-600">20%</div>
                    <div class="text-[10px] text-gray-500">Tax Relief</div>
                </div>
                <div class="bg-white/80 rounded-xl p-3">
                    <div class="text-lg font-bold text-emerald-600">4.8â˜…</div>
                    <div class="text-[10px] text-gray-500">Avg Rating</div>
                </div>
            </div>
        </div>

        <div v-if="appMode === 'emergency'" class="animate-fade-in">
            
            <button v-if="triageStep !== 'ae_redirect' && triageStep !== 'results' && triageStep !== 'confirmed'" @click="goBackTriage" class="flex items-center gap-2 text-gray-500 hover:text-gray-700 mb-4">
                <i class="ph ph-arrow-left"></i>
                <span class="text-sm">Back</span>
            </button>
            
            <div v-if="triageStep === 1" class="bg-white rounded-2xl shadow-soft p-5 space-y-4">
                <h2 class="text-lg font-semibold text-gray-900">First, let's check for anything serious</h2>
                <p class="text-sm text-gray-500">Select any that apply to you right now</p>
                
                <div class="space-y-2">
                    <label v-for="flag in redFlags" :key="flag.id"
                           :class="['flex items-center gap-3 p-4 rounded
